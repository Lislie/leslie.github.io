$(function(){function e(){var e,o=100,a=50,c=50,p,E;e=document.createElement("div"),e.style.position="fixed",e.style.top="0px",e.style.left="0px",e.style.zIndex="-1",e.style.opacity="0.5",document.body.appendChild(e),m=new THREE.PerspectiveCamera(75,s/l,1,1e4),m.position.z=1e3,v=new THREE.Scene,R=new THREE.CanvasRenderer,R.setClearColor(16119801,0),R.setPixelRatio(window.devicePixelRatio),R.setSize(s,l),e.appendChild(R.domElement);for(var d=2*Math.PI,h=new THREE.SpriteCanvasMaterial({color:10263708,program:function(e){e.beginPath(),e.arc(0,0,.5,0,d,!0),e.fill()}}),f=0;f<1e3;f++)E=new THREE.Sprite(h),E.position.x=2*Math.random()-1,E.position.y=2*Math.random()-1,E.position.z=2*Math.random()-1,E.position.normalize(),E.position.multiplyScalar(10*Math.random()+450),E.scale.multiplyScalar(2),v.add(E);for(var f=0;f<300;f++){var u=new THREE.Geometry,x=new THREE.Vector3(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1);x.normalize(),x.multiplyScalar(450),u.vertices.push(x);var y=x.clone();y.multiplyScalar(.3*Math.random()+1),u.vertices.push(y);var T=new THREE.Line(u,new THREE.LineBasicMaterial({color:10263708,opacity:Math.random()}));v.add(T)}document.addEventListener("mousemove",r,!1),document.addEventListener("touchstart",i,!1),document.addEventListener("touchmove",n,!1),window.addEventListener("resize",t,!1)}function t(){E=window.innerWidth/2,d=window.innerHeight/2,m.aspect=window.innerWidth/window.innerHeight,m.updateProjectionMatrix(),R.setSize(window.innerWidth,window.innerHeight)}function r(e){c=e.clientX-E,p=e.clientY-d}function i(e){e.touches.length>1&&(c=e.touches[0].pageX-E)}function n(e){1==e.touches.length&&(c=e.touches[0].pageX-E)}function o(){requestAnimationFrame(o),a()}function a(){m.position.x+=.05*(c-m.position.x),m.position.y+=.05*(-p+200-m.position.y),m.lookAt(v.position),R.render(v,m)}var s=window.innerWidth,l=window.innerHeight,c=0,p=0,E=window.innerWidth/2,d=window.innerHeight/2,h=200,f=10,u=10,m,v,R;e(),o()}),THREE.RenderableObject=function(){this.id=0,this.object=null,this.z=0,this.renderOrder=0},THREE.RenderableFace=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.normalModel=new THREE.Vector3,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsLength=0,this.color=new THREE.Color,this.material=null,this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2],this.z=0,this.renderOrder=0},THREE.RenderableVertex=function(){this.position=new THREE.Vector3,this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},THREE.RenderableLine=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.vertexColors=[new THREE.Color,new THREE.Color],this.material=null,this.z=0,this.renderOrder=0},THREE.RenderableSprite=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new THREE.Vector2,this.material=null,this.renderOrder=0},THREE.Projector=function(){function e(){if(l===p){var e=new THREE.RenderableObject;return c.push(e),p++,l++,e}return c[l++]}function t(){if(d===f){var e=new THREE.RenderableVertex;return h.push(e),f++,d++,e}return h[d++]}function r(){if(m===R){var e=new THREE.RenderableFace;return v.push(e),R++,m++,e}return v[m++]}function i(){if(y===w){var e=new THREE.RenderableLine;return T.push(e),w++,y++,e}return T[y++]}function n(){if(g===M){var e=new THREE.RenderableSprite;return S.push(e),M++,g++,e}return S[g++]}function o(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id!==t.id?e.id-t.id:0}function a(e,t){var r=0,i=1,n=e.z+e.w,o=t.z+t.w,a=-e.z+e.w,s=-t.z+t.w;return n>=0&&o>=0&&a>=0&&s>=0||!(n<0&&o<0||a<0&&s<0)&&(n<0?r=Math.max(r,n/(n-o)):o<0&&(i=Math.min(i,n/(n-o))),a<0?r=Math.max(r,a/(a-s)):s<0&&(i=Math.min(i,a/(a-s))),!(i<r)&&(e.lerp(t,r),t.lerp(e,1-i),!0))}var s,l,c=[],p=0,E,d,h=[],f=0,u,m,v=[],R=0,x,y,T=[],w=0,H,g,S=[],M=0,C={objects:[],lights:[],elements:[]},b=new THREE.Vector3,z=new THREE.Vector4,V=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),j=new THREE.Box3,L=new Array(3),O=new Array(4),B=new THREE.Matrix4,W=new THREE.Matrix4,P,k=new THREE.Matrix4,N=new THREE.Matrix3,F=new THREE.Frustum,A=new THREE.Vector4,I=new THREE.Vector4;this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(e,t){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};var D=function(){function e(e){v=e,R=v.material,y.getNormalMatrix(v.matrixWorld),f.length=0,m.length=0}function n(e){var t=e.position,r=e.positionWorld,i=e.positionScreen;r.copy(t).applyMatrix4(P),i.copy(r).applyMatrix4(W);var n=1/i.w;i.x*=n,i.y*=n,i.z*=n,e.visible=i.x>=-1&&i.x<=1&&i.y>=-1&&i.y<=1&&i.z>=-1&&i.z<=1}function o(e,r,i){E=t(),E.position.set(e,r,i),n(E)}function a(e,t,r){f.push(e,t,r)}function s(e,t){m.push(e,t)}function l(e,t,r){return e.visible===!0||t.visible===!0||r.visible===!0||(L[0]=e.positionScreen,L[1]=t.positionScreen,L[2]=r.positionScreen,V.intersectsBox(j.setFromPoints(L)))}function c(e,t,r){return(r.positionScreen.x-e.positionScreen.x)*(t.positionScreen.y-e.positionScreen.y)-(r.positionScreen.y-e.positionScreen.y)*(t.positionScreen.x-e.positionScreen.x)<0}function p(e,t){var r=h[e],n=h[t];x=i(),x.id=v.id,x.v1.copy(r),x.v2.copy(n),x.z=(r.positionScreen.z+n.positionScreen.z)/2,x.renderOrder=v.renderOrder,x.material=v.material,C.elements.push(x)}function d(e,t,i){var n=h[e],o=h[t],a=h[i];if(l(n,o,a)!==!1&&(R.side===THREE.DoubleSide||c(n,o,a)===!0)){u=r(),u.id=v.id,u.v1.copy(n),u.v2.copy(o),u.v3.copy(a),u.z=(n.positionScreen.z+o.positionScreen.z+a.positionScreen.z)/3,u.renderOrder=v.renderOrder,u.normalModel.fromArray(f,3*e),u.normalModel.applyMatrix3(y).normalize();for(var s=0;s<3;s++){var p=u.vertexNormalsModel[s];p.fromArray(f,3*arguments[s]),p.applyMatrix3(y).normalize();var E=u.uvs[s];E.fromArray(m,2*arguments[s])}u.vertexNormalsLength=3,u.material=v.material,C.elements.push(u)}}var f=[],m=[],v=null,R=null,y=new THREE.Matrix3;return{setObject:e,projectVertex:n,checkTriangleVisibility:l,checkBackfaceCulling:c,pushVertex:o,pushNormal:a,pushUv:s,pushLine:p,pushTriangle:d}},G=new D;this.projectScene=function(c,p,E,f){function v(t){s=e(),s.id=t.id,s.object=t,b.setFromMatrixPosition(t.matrixWorld),b.applyMatrix4(W),s.z=b.z,s.renderOrder=t.renderOrder,C.objects.push(s)}m=0,y=0,g=0,C.elements.length=0,c.autoUpdate===!0&&c.updateMatrixWorld(),null===p.parent&&p.updateMatrixWorld(),B.copy(p.matrixWorldInverse.getInverse(p.matrixWorld)),W.multiplyMatrices(p.projectionMatrix,B),F.setFromMatrix(W),l=0,C.objects.length=0,C.lights.length=0,c.traverseVisible(function(e){if(e instanceof THREE.Light)C.lights.push(e);else if(e instanceof THREE.Mesh||e instanceof THREE.Line){if(e.material.visible===!1)return;if(e.frustumCulled===!0&&F.intersectsObject(e)===!1)return;v(e)}else if(e instanceof THREE.Sprite){if(e.material.visible===!1)return;if(e.frustumCulled===!0&&F.intersectsSprite(e)===!1)return;v(e)}}),E===!0&&C.objects.sort(o);for(var R=0,T=C.objects.length;R<T;R++){var w=C.objects[R].object,S=w.geometry;if(G.setObject(w),P=w.matrixWorld,d=0,w instanceof THREE.Mesh){if(S instanceof THREE.BufferGeometry){var M=S.attributes,V=S.groups;if(void 0===M.position)continue;for(var j=M.position.array,L=0,O=j.length;L<O;L+=3)G.pushVertex(j[L],j[L+1],j[L+2]);if(void 0!==M.normal)for(var D=M.normal.array,L=0,O=D.length;L<O;L+=3)G.pushNormal(D[L],D[L+1],D[L+2]);if(void 0!==M.uv)for(var U=M.uv.array,L=0,O=U.length;L<O;L+=2)G.pushUv(U[L],U[L+1]);if(null!==S.index){var q=S.index.array;if(V.length>0)for(var X=0;X<V.length;X++)for(var J=V[X],L=J.start,O=J.start+J.count;L<O;L+=3)G.pushTriangle(q[L],q[L+1],q[L+2]);else for(var L=0,O=q.length;L<O;L+=3)G.pushTriangle(q[L],q[L+1],q[L+2])}else for(var L=0,O=j.length/3;L<O;L+=3)G.pushTriangle(L,L+1,L+2)}else if(S instanceof THREE.Geometry){var Y=S.vertices,K=S.faces,Q=S.faceVertexUvs[0];N.getNormalMatrix(P);for(var Z=w.material,_=Z instanceof THREE.MultiMaterial,ee=_===!0?w.material:null,te=0,re=Y.length;te<re;te++){var ie=Y[te];if(b.copy(ie),Z.morphTargets===!0)for(var ne=S.morphTargets,oe=w.morphTargetInfluences,ae=0,se=ne.length;ae<se;ae++){var le=oe[ae];if(0!==le){var ce=ne[ae],pe=ce.vertices[te];b.x+=(pe.x-ie.x)*le,b.y+=(pe.y-ie.y)*le,b.z+=(pe.z-ie.z)*le}}G.pushVertex(b.x,b.y,b.z)}for(var Ee=0,de=K.length;Ee<de;Ee++){var he=K[Ee];if(Z=_===!0?ee.materials[he.materialIndex]:w.material,void 0!==Z){var fe=Z.side,ue=h[he.a],me=h[he.b],ve=h[he.c];if(G.checkTriangleVisibility(ue,me,ve)!==!1){var Re=G.checkBackfaceCulling(ue,me,ve);if(fe!==THREE.DoubleSide){if(fe===THREE.FrontSide&&Re===!1)continue;if(fe===THREE.BackSide&&Re===!0)continue}u=r(),u.id=w.id,u.v1.copy(ue),u.v2.copy(me),u.v3.copy(ve),u.normalModel.copy(he.normal),Re!==!1||fe!==THREE.BackSide&&fe!==THREE.DoubleSide||u.normalModel.negate(),u.normalModel.applyMatrix3(N).normalize();for(var xe=he.vertexNormals,ye=0,Te=Math.min(xe.length,3);ye<Te;ye++){var we=u.vertexNormalsModel[ye];we.copy(xe[ye]),Re!==!1||fe!==THREE.BackSide&&fe!==THREE.DoubleSide||we.negate(),we.applyMatrix3(N).normalize()}u.vertexNormalsLength=xe.length;var He=Q[Ee];if(void 0!==He)for(var ge=0;ge<3;ge++)u.uvs[ge].copy(He[ge]);u.color=he.color,u.material=Z,u.z=(ue.positionScreen.z+me.positionScreen.z+ve.positionScreen.z)/3,u.renderOrder=w.renderOrder,C.elements.push(u)}}}}}else if(w instanceof THREE.Line){if(S instanceof THREE.BufferGeometry){var M=S.attributes;if(void 0!==M.position){for(var j=M.position.array,L=0,O=j.length;L<O;L+=3)G.pushVertex(j[L],j[L+1],j[L+2]);if(null!==S.index)for(var q=S.index.array,L=0,O=q.length;L<O;L+=2)G.pushLine(q[L],q[L+1]);else for(var Se=w instanceof THREE.LineSegments?2:1,L=0,O=j.length/3-1;L<O;L+=Se)G.pushLine(L,L+1)}}else if(S instanceof THREE.Geometry){k.multiplyMatrices(W,P);var Y=w.geometry.vertices;if(0===Y.length)continue;ue=t(),ue.positionScreen.copy(Y[0]).applyMatrix4(k);for(var Se=w instanceof THREE.LineSegments?2:1,te=1,re=Y.length;te<re;te++)ue=t(),ue.positionScreen.copy(Y[te]).applyMatrix4(k),(te+1)%Se>0||(me=h[d-2],A.copy(ue.positionScreen),I.copy(me.positionScreen),a(A,I)===!0&&(A.multiplyScalar(1/A.w),I.multiplyScalar(1/I.w),x=i(),x.id=w.id,x.v1.positionScreen.copy(A),x.v2.positionScreen.copy(I),x.z=Math.max(A.z,I.z),x.renderOrder=w.renderOrder,x.material=w.material,w.material.vertexColors===THREE.VertexColors&&(x.vertexColors[0].copy(w.geometry.colors[te]),x.vertexColors[1].copy(w.geometry.colors[te-1])),C.elements.push(x)))}}else if(w instanceof THREE.Sprite){z.set(P.elements[12],P.elements[13],P.elements[14],1),z.applyMatrix4(W);var Me=1/z.w;z.z*=Me,z.z>=-1&&z.z<=1&&(H=n(),H.id=w.id,H.x=z.x*Me,H.y=z.y*Me,H.z=z.z,H.renderOrder=w.renderOrder,H.object=w,H.rotation=w.rotation,H.scale.x=w.scale.x*Math.abs(H.x-(z.x+p.projectionMatrix.elements[0])/(z.w+p.projectionMatrix.elements[12])),H.scale.y=w.scale.y*Math.abs(H.y-(z.y+p.projectionMatrix.elements[5])/(z.w+p.projectionMatrix.elements[13])),H.material=w.material,C.elements.push(H))}}return f===!0&&C.elements.sort(o),C}},THREE.SpriteCanvasMaterial=function(e){THREE.Material.call(this),this.type="SpriteCanvasMaterial",this.color=new THREE.Color(16777215),this.program=function(e,t){},this.setValues(e)},THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial,THREE.SpriteCanvasMaterial.prototype.clone=function(){var e=new THREE.SpriteCanvasMaterial;return e.copy(this),e.color.copy(this.color),e.program=this.program,e},THREE.CanvasRenderer=function(e){function t(){Oe.setRGB(0,0,0),Be.setRGB(0,0,0),We.setRGB(0,0,0);for(var e=0,t=g.length;e<t;e++){var r=g[e],i=r.color;r instanceof THREE.AmbientLight?Oe.add(i):r instanceof THREE.DirectionalLight?Be.add(i):r instanceof THREE.PointLight&&We.add(i)}}function r(e,t,r){for(var i=0,n=g.length;i<n;i++){var o=g[i];if(ye.copy(o.color),o instanceof THREE.DirectionalLight){var a=Pe.setFromMatrixPosition(o.matrixWorld).normalize(),s=t.dot(a);if(s<=0)continue;s*=o.intensity,r.add(ye.multiplyScalar(s))}else if(o instanceof THREE.PointLight){var a=Pe.setFromMatrixPosition(o.matrixWorld),s=t.dot(Pe.subVectors(a,e).normalize());if(s<=0)continue;if(s*=0==o.distance?1:1-Math.min(e.distanceTo(a)/o.distance,1),0==s)continue;s*=o.intensity,r.add(ye.multiplyScalar(s))}}}function i(e,t,r){h(r.opacity),f(r.blending);var i=t.scale.x*z,n=t.scale.y*V,o=.5*Math.sqrt(i*i+n*n);if(Le.min.set(e.x-o,e.y-o),Le.max.set(e.x+o,e.y+o),r instanceof THREE.SpriteMaterial){var a=r.map;if(null!==a){var s=Te[a.id];if(void 0!==s&&s.version===a.version||(s=c(a),Te[a.id]=s),void 0!==s.canvas){x(s.canvas);var l=a.image,p=l.width*a.offset.x,E=l.height*a.offset.y,d=l.width*a.repeat.x,u=l.height*a.repeat.y,m=i/d,v=n/u;P.save(),P.translate(e.x,e.y),0!==r.rotation&&P.rotate(r.rotation),P.translate(-i/2,-n/2),P.scale(m,v),P.translate(-p,-E),P.fillRect(p,E,d,u),P.restore()}}else x(r.color.getStyle()),P.save(),P.translate(e.x,e.y),0!==r.rotation&&P.rotate(r.rotation),P.scale(i,-n),P.fillRect(-.5,-.5,1,1),P.restore()}else r instanceof THREE.SpriteCanvasMaterial&&(R(r.color.getStyle()),x(r.color.getStyle()),P.save(),P.translate(e.x,e.y),0!==r.rotation&&P.rotate(r.rotation),P.scale(i,n),r.program(P),P.restore())}function n(e,t,r,i){if(h(i.opacity),f(i.blending),P.beginPath(),P.moveTo(e.positionScreen.x,e.positionScreen.y),P.lineTo(t.positionScreen.x,t.positionScreen.y),i instanceof THREE.LineBasicMaterial){if(u(i.linewidth),m(i.linecap),v(i.linejoin),i.vertexColors!==THREE.VertexColors)R(i.color.getStyle());else{var n=r.vertexColors[0].getStyle(),o=r.vertexColors[1].getStyle();if(n===o)R(n);else{try{var a=P.createLinearGradient(e.positionScreen.x,e.positionScreen.y,t.positionScreen.x,t.positionScreen.y);a.addColorStop(0,n),a.addColorStop(1,o)}catch(e){a=n}R(a)}}P.stroke(),Le.expandByScalar(2*i.linewidth)}else i instanceof THREE.LineDashedMaterial&&(u(i.linewidth),m(i.linecap),v(i.linejoin),R(i.color.getStyle()),y([i.dashSize,i.gapSize]),P.stroke(),Le.expandByScalar(2*i.linewidth),y([]))}function o(e,t,i,n,o,c,E,d){if(T.info.render.vertices+=3,T.info.render.faces++,h(d.opacity),f(d.blending),te=e.positionScreen.x,re=e.positionScreen.y,ie=t.positionScreen.x,ne=t.positionScreen.y,oe=i.positionScreen.x,ae=i.positionScreen.y,a(te,re,ie,ne,oe,ae),(d instanceof THREE.MeshLambertMaterial||d instanceof THREE.MeshPhongMaterial)&&null===d.map)Re.copy(d.color),xe.copy(d.emissive),d.vertexColors===THREE.FaceColors&&Re.multiply(E.color),he.copy(Oe),ke.copy(e.positionWorld).add(t.positionWorld).add(i.positionWorld).divideScalar(3),r(ke,E.normalModel,he),he.multiply(Re).add(xe),d.wireframe===!0?s(he,d.wireframeLinewidth,d.wireframeLinecap,d.wireframeLinejoin):l(he);else if(d instanceof THREE.MeshBasicMaterial||d instanceof THREE.MeshLambertMaterial||d instanceof THREE.MeshPhongMaterial)if(null!==d.map){var u=d.map.mapping;u===THREE.UVMapping&&(He=E.uvs,p(te,re,ie,ne,oe,ae,He[n].x,He[n].y,He[o].x,He[o].y,He[c].x,He[c].y,d.map))}else null!==d.envMap?d.envMap.mapping===THREE.SphericalReflectionMapping&&(Ne.copy(E.vertexNormalsModel[n]).applyMatrix3(Fe),ge=.5*Ne.x+.5,Se=.5*Ne.y+.5,Ne.copy(E.vertexNormalsModel[o]).applyMatrix3(Fe),Me=.5*Ne.x+.5,Ce=.5*Ne.y+.5,Ne.copy(E.vertexNormalsModel[c]).applyMatrix3(Fe),be=.5*Ne.x+.5,ze=.5*Ne.y+.5,p(te,re,ie,ne,oe,ae,ge,Se,Me,Ce,be,ze,d.envMap)):(he.copy(d.color),d.vertexColors===THREE.FaceColors&&he.multiply(E.color),d.wireframe===!0?s(he,d.wireframeLinewidth,d.wireframeLinecap,d.wireframeLinejoin):l(he));else d instanceof THREE.MeshNormalMaterial?(Ne.copy(E.normalModel).applyMatrix3(Fe),he.setRGB(Ne.x,Ne.y,Ne.z).multiplyScalar(.5).addScalar(.5),d.wireframe===!0?s(he,d.wireframeLinewidth,d.wireframeLinecap,d.wireframeLinejoin):l(he)):(he.setRGB(1,1,1),d.wireframe===!0?s(he,d.wireframeLinewidth,d.wireframeLinecap,d.wireframeLinejoin):l(he))}function a(e,t,r,i,n,o){P.beginPath(),P.moveTo(e,t),P.lineTo(r,i),P.lineTo(n,o),P.closePath()}function s(e,t,r,i){u(t),m(r),v(i),R(e.getStyle()),P.stroke(),Le.expandByScalar(2*t)}function l(e){x(e.getStyle()),P.fill()}function c(e){if(0===e.version||e instanceof THREE.CompressedTexture||e instanceof THREE.DataTexture)return{canvas:void 0,version:e.version};var t=e.image;if(t.complete===!1)return{canvas:void 0,version:0};var r=e.wrapS===THREE.RepeatWrapping||e.wrapS===THREE.MirroredRepeatWrapping,i=e.wrapT===THREE.RepeatWrapping||e.wrapT===THREE.MirroredRepeatWrapping,n=e.wrapS===THREE.MirroredRepeatWrapping,o=e.wrapT===THREE.MirroredRepeatWrapping,a=document.createElement("canvas");a.width=t.width*(n?2:1),a.height=t.height*(o?2:1);var s=a.getContext("2d");s.setTransform(1,0,0,-1,0,t.height),s.drawImage(t,0,0),n===!0&&(s.setTransform(-1,0,0,-1,t.width,t.height),s.drawImage(t,-t.width,0)),o===!0&&(s.setTransform(1,0,0,1,0,0),s.drawImage(t,0,t.height)),n===!0&&o===!0&&(s.setTransform(-1,0,0,1,t.width,0),s.drawImage(t,-t.width,t.height));var l="no-repeat";r===!0&&i===!0?l="repeat":r===!0?l="repeat-x":i===!0&&(l="repeat-y");var c=P.createPattern(a,l);return e.onUpdate&&e.onUpdate(e),{canvas:c,version:e.version}}function p(e,t,r,i,n,o,a,s,l,p,E,d,h){var f=Te[h.id];if(void 0!==f&&f.version===h.version||(f=c(h),Te[h.id]=f),void 0===f.canvas)return x("rgba( 0, 0, 0, 1)"),void P.fill();x(f.canvas);var u,m,v,R,y,T,w,H,g=h.offset.x/h.repeat.x,S=h.offset.y/h.repeat.y,M=h.image.width*h.repeat.x,C=h.image.height*h.repeat.y;a=(a+g)*M,s=(s+S)*C,l=(l+g)*M,p=(p+S)*C,E=(E+g)*M,d=(d+S)*C,r-=e,i-=t,n-=e,o-=t,l-=a,p-=s,E-=a,d-=s,w=l*d-E*p,0!==w&&(H=1/w,u=(d*r-p*n)*H,m=(d*i-p*o)*H,v=(l*n-E*r)*H,R=(l*o-E*i)*H,y=e-u*a-v*s,T=t-m*a-R*s,P.save(),P.transform(u,m,v,R,y,T),P.fill(),P.restore())}function E(e,t,r,i,n,o,a,s,l,c,p,E,d){var h,f,u,m,v,R,x,y,T=d.width-1,w=d.height-1;a*=T,s*=w,l*=T,c*=w,p*=T,E*=w,r-=e,i-=t,n-=e,o-=t,l-=a,c-=s,p-=a,E-=s,x=l*E-p*c,y=1/x,h=(E*r-c*n)*y,f=(E*i-c*o)*y,u=(l*n-p*r)*y,m=(l*o-p*i)*y,v=e-h*a-u*s,R=t-f*a-m*s,P.save(),P.transform(h,f,u,m,v,R),P.clip(),P.drawImage(d,0,0),P.restore()}function d(e,t,r){var i=t.x-e.x,n=t.y-e.y,o=i*i+n*n,a;0!==o&&(a=r/Math.sqrt(o),i*=a,n*=a,t.x+=i,t.y+=n,e.x-=i,e.y-=n)}function h(e){F!==e&&(P.globalAlpha=e,F=e)}function f(e){A!==e&&(e===THREE.NormalBlending?P.globalCompositeOperation="source-over":e===THREE.AdditiveBlending?P.globalCompositeOperation="lighter":e===THREE.SubtractiveBlending?P.globalCompositeOperation="darker":e===THREE.MultiplyBlending&&(P.globalCompositeOperation="multiply"),A=e)}function u(e){G!==e&&(P.lineWidth=e,G=e)}function m(e){U!==e&&(P.lineCap=e,U=e)}function v(e){q!==e&&(P.lineJoin=e,q=e)}function R(e){I!==e&&(P.strokeStyle=e,I=e)}function x(e){D!==e&&(P.fillStyle=e,D=e)}function y(e){X.length!==e.length&&(P.setLineDash(e),X=e)}console.log("THREE.CanvasRenderer",THREE.REVISION),e=e||{};var T=this,w,H,g,S=new THREE.Projector,M=void 0!==e.canvas?e.canvas:document.createElement("canvas"),C=M.width,b=M.height,z=Math.floor(C/2),V=Math.floor(b/2),j=0,L=0,O=C,B=b,W=1,P=M.getContext("2d",{alpha:e.alpha===!0}),k=new THREE.Color(0),N=e.alpha===!0?0:1,F=1,A=0,I=null,D=null,G=null,U=null,q=null,X=[],J,Y,K,Q,Z,_=new THREE.RenderableVertex,ee=new THREE.RenderableVertex,te,re,ie,ne,oe,ae,se,le,ce,pe,Ee,de,he=new THREE.Color,fe=new THREE.Color,ue=new THREE.Color,me=new THREE.Color,ve=new THREE.Color,Re=new THREE.Color,xe=new THREE.Color,ye=new THREE.Color,Te={},we,He,ge,Se,Me,Ce,be,ze,Ve=new THREE.Box2,je=new THREE.Box2,Le=new THREE.Box2,Oe=new THREE.Color,Be=new THREE.Color,We=new THREE.Color,Pe=new THREE.Vector3,ke=new THREE.Vector3,Ne=new THREE.Vector3,Fe=new THREE.Matrix3;void 0===P.setLineDash&&(P.setLineDash=function(){}),this.domElement=M,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.getContext=function(){return P},this.getContextAttributes=function(){return P.getContextAttributes()},this.getPixelRatio=function(){return W},this.setPixelRatio=function(e){void 0!==e&&(W=e)},this.setSize=function(e,t,r){C=e*W,b=t*W,M.width=C,M.height=b,z=Math.floor(C/2),V=Math.floor(b/2),r!==!1&&(M.style.width=e+"px",M.style.height=t+"px"),Ve.min.set(-z,-V),Ve.max.set(z,V),je.min.set(-z,-V),je.max.set(z,V),F=1,A=0,I=null,D=null,G=null,U=null,q=null,this.setViewport(0,0,e,t)},this.setViewport=function(e,t,r,i){j=e*W,L=t*W,O=r*W,B=i*W},this.setScissor=function(){},this.setScissorTest=function(){},this.setClearColor=function(e,t){k.set(e),N=void 0!==t?t:1,je.min.set(-z,-V),je.max.set(z,V)},this.setClearColorHex=function(e,t){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getClearColor=function(){return k},this.getClearAlpha=function(){return N},this.getMaxAnisotropy=function(){return 0},this.clear=function(){je.isEmpty()===!1&&(je.intersect(Ve),je.expandByScalar(2),je.min.x=je.min.x+z,je.min.y=-je.min.y+V,je.max.x=je.max.x+z,je.max.y=-je.max.y+V,N<1&&P.clearRect(0|je.min.x,0|je.max.y,je.max.x-je.min.x|0,je.min.y-je.max.y|0),N>0&&(f(THREE.NormalBlending),h(1),x("rgba("+Math.floor(255*k.r)+","+Math.floor(255*k.g)+","+Math.floor(255*k.b)+","+N+")"),P.fillRect(0|je.min.x,0|je.max.y,je.max.x-je.min.x|0,je.min.y-je.max.y|0)),je.makeEmpty())},this.clearColor=function(){},this.clearDepth=function(){},this.clearStencil=function(){},this.render=function(e,r){if(r instanceof THREE.Camera==!1)return void console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");var a=e.background;a&&a.isColor?(x("rgb("+Math.floor(255*a.r)+","+Math.floor(255*a.g)+","+Math.floor(255*a.b)+")"),P.fillRect(0,0,C,b)):this.autoClear===!0&&this.clear(),T.info.render.vertices=0,T.info.render.faces=0,P.setTransform(O/C,0,0,-B/b,j,b-L),P.translate(z,V),w=S.projectScene(e,r,this.sortObjects,this.sortElements),H=w.elements,g=w.lights,J=r,Fe.getNormalMatrix(r.matrixWorldInverse),t();for(var s=0,l=H.length;s<l;s++){var c=H[s],p=c.material;if(void 0!==p&&0!==p.opacity){if(Le.makeEmpty(),c instanceof THREE.RenderableSprite)Y=c,Y.x*=z,Y.y*=V,i(Y,c,p);else if(c instanceof THREE.RenderableLine)Y=c.v1,K=c.v2,Y.positionScreen.x*=z,Y.positionScreen.y*=V,K.positionScreen.x*=z,K.positionScreen.y*=V,Le.setFromPoints([Y.positionScreen,K.positionScreen]),Ve.intersectsBox(Le)===!0&&n(Y,K,c,p);else if(c instanceof THREE.RenderableFace){if(Y=c.v1,K=c.v2,Q=c.v3,Y.positionScreen.z<-1||Y.positionScreen.z>1)continue;if(K.positionScreen.z<-1||K.positionScreen.z>1)continue;if(Q.positionScreen.z<-1||Q.positionScreen.z>1)continue;Y.positionScreen.x*=z,Y.positionScreen.y*=V,K.positionScreen.x*=z,K.positionScreen.y*=V,Q.positionScreen.x*=z,Q.positionScreen.y*=V,p.overdraw>0&&(d(Y.positionScreen,K.positionScreen,p.overdraw),d(K.positionScreen,Q.positionScreen,p.overdraw),d(Q.positionScreen,Y.positionScreen,p.overdraw)),Le.setFromPoints([Y.positionScreen,K.positionScreen,Q.positionScreen]),Ve.intersectsBox(Le)===!0&&o(Y,K,Q,0,1,2,c,p)}je.union(Le)}}P.setTransform(1,0,0,1,0,0)}};